!function(e){e.fn.datagrid=function(t){function i(){var t="<thead></thead><tbody></tbody>";e(E).append(t)}function a(){var t="<tr id='thead-merge-cells'></tr>";if(e(E).find("thead").append(t),1==j.rowNumber){var i="<th sortable='false' style='text-align: center; width: 20px;' rowspan='2'>No</th>";e(E).find("#thead-merge-cells").append(i)}if(1==j.rowCheck){var a="<th sortable='false' style='text-align: center; width: 20px;' rowspan='2'><input type='checkbox'></th>";e(E).find("#thead-merge-cells").append(a),u()}if(!e.isEmptyObject(j.rowDetail)){var r="<th sortable='false' style='text-align: center; width: 20px;' rowspan='2'></th>";e(E).find("#thead-merge-cells").append(r)}j.columns.forEach(function(t,i){var a=!1,r="",n="",o="";j.mergeCells.forEach(function(e){i==e.index&&(a=!0,r=e.align,n=e.colspan,o=e.title)}),a||j.mergeCells.forEach(function(e){i>e.index&&i<e.index+e.colspan&&(a=null)});var l="";a?l="<th sortable='false' style='text-align: "+r+";' colspan='"+n+"'>"+o+"</th>":0==a&&(t.sortable=void 0==t.sortable?!0:t.sortable,t.width=void 0==t.width?150:t.width,t.align=void 0==t.align?"center":t.align,l="<th title='"+t.field+"' sortable='"+t.sortable+"' style='text-align: "+t.align+"; width: "+t.width+"px;' rowspan='2'>"+t.title+"</th>"),e(E).find("#thead-merge-cells").append(l)})}function r(){var t="<tr id='thead-title'></tr>";if(e(E).find("thead").append(t),1==j.rowNumber&&0==j.mergeCells.length){var i="<th sortable='false' style='text-align: center; width: 20px;'>No</th>";e(E).find("#thead-title").append(i)}if(1==j.rowCheck&&0==j.mergeCells.length){var a="<th sortable='false' style='text-align: center; width: 20px;'><input type='checkbox'></th>";e(E).find("#thead-title").append(a),u()}if(!e.isEmptyObject(j.rowDetail)&&0==j.mergeCells.length){var r="<th sortable='false' style='text-align: center; width: 20px;'></th>";e(E).find("#thead-title").append(r)}j.columns.forEach(function(t,i){var a=!1;j.mergeCells.length>0?j.mergeCells.forEach(function(e){i>=e.index&&i<e.index+e.colspan&&(a=!0)}):a=!0;var r;a&&(t.sortable=void 0==t.sortable?!0:t.sortable,t.width=void 0==t.width?150:t.width,t.align=void 0==t.align?"center":t.align,r="<th title='"+t.field+"' sortable='"+t.sortable+"' style='text-align: "+t.align+"; width: "+t.width+"px;'>"+t.title+"</th>"),e(E).find("#thead-title").append(r)})}function n(t,i,a,r){var n=e.extend({limit:parseInt(t)*i-i,offset:i,sort:j.sortBy,order:j.orderBy,dataSearch:a},j.queryParams);e.ajax({url:j.url,type:"post",dataType:"json",data:n,success:function(e){C=e,r()}})}function o(t){var i=j.columns.length+(d()+1),a="<tr><td colspan='"+i+"' style='text-align: center;'>"+t+"</td></tr>";e(E).find("tbody").html(a)}function l(t,i,a){o("Loading data..."),n(t,i,a,function(){var a=parseInt(t)*i-i+1,r="",n="",c="";if(parseInt(t)>Math.ceil(C.total/i)&&Math.ceil(C.total/i)>0&&(j.activePageNumber=1,l(j.activePageNumber,j.itemsPerPage,v())),C.total>=1){for(var d=0;d<C.rows.length;d++)r+="<tr class='main-row'>",j.rowNumber&&(r+="<td style='text-align: center;'>"+a+"</td>"),j.rowCheck&&(r+="<td class='checkbox-column' style='text-align: center;'><input value='"+C.rows[d][j.primaryField]+"' type='checkbox'></td>"),e.isEmptyObject(j.rowDetail)||(r+="<td style='text-align: center;'><div class='detail-link' data-id='"+d+"' data-expand='false' style='width: 10px; height: 4px; margin-left: auto; margin-right: auto; cursor: pointer; margin-top: 8px; background-color: #595959; border: 1px solid #595959; -border-radius: 0.1em; -moz-border-radius: 0.1em; -webkit-border-radius: 0.1em;'><div style='width: 4px; height: 10px; cursor: pointer; margin-top: -4px; margin-left: 2px; background-color: #595959; border: 1px solid #595959; -border-radius: 0.1em; -moz-border-radius: 0.1em; -webkit-border-radius: 0.1em;'></div></div></td>"),j.columns.forEach(function(e){"undefined"!=typeof C.rows[d][e.field]?r+="<td style='text-align: "+e.align+"; width: "+e.width+"px;'>"+C.rows[d][e.field]+"</td>":"undefined"!=typeof e.rowStyler?(n=C.rows[d],c=d,r+="<td style='text-align: "+e.align+"; width: "+e.width+"px;'>"+e.rowStyler(C.rows[d],d)+"</td>"):r+="<td style='text-align: "+e.align+"; width: "+e.width+"px;'>Undefined</td>"}),r+="</tr>",a++;e(E).find("tbody").html(r)}else o("No records found...");s(t,i),h(),w(t,i),y()})}function s(t,i){var a="",r=t>1?"":'class="disabled"';a+="<li "+r+' title="first"><a href="javascript:void(0);">First</a></li>',a+="<li "+r+' title="prev"><a href="javascript:void(0);">Prev</a></li>',t==Math.ceil(C.total/i)&&t-2>=1&&(a+='<li title="'+(t-2)+'"><a href="javascript:void(0);">'+(t-2)+"</a></li>"),t-1>=1&&(a+='<li title="'+(t-1)+'"><a href="javascript:void(0);">'+(t-1)+"</a></li>"),a+='<li class="active" title="'+t+'"><a href="javascript:void(0);">'+t+"</a></li>",t+1<=Math.ceil(C.total/i)&&(a+='<li title="'+(t+1)+'"><a href="javascript:void(0);">'+(t+1)+"</a></li>"),1==t&&Math.ceil(C.total/i)>2&&(a+='<li title="'+(t+2)+'"><a href="javascript:void(0);">'+(t+2)+"</a></li>");var n=t<Math.ceil(C.total/i)?"":'class="disabled"';a+="<li "+n+' title="next"><a href="javascript:void(0);">Next</a></li>',a+="<li "+n+' title="last"><a href="javascript:void(0);">Last</a></li>',e(j.pagingElement).html(a),Math.ceil(C.total/i)>1?e(j.pagingElement).children("li").each(function(){e(this).on("click",function(){"prev"==this.title&&t-1>=1?(l(t-1,i,v()),j.activePageNumber--):"next"==this.title&&t+1<=Math.ceil(C.total/i)?(l(t+1,i,v()),j.activePageNumber++):"first"==this.title?(l(1,i,v()),j.activePageNumber=1):"last"==this.title?(l(Math.ceil(C.total/i),i,v()),j.activePageNumber=Math.ceil(C.total/i)):(parseInt(this.title)<=t+2||parseInt(this.title)>=t-2)&&(l(parseInt(this.title),i,v()),j.activePageNumber=this.title)})}):e(j.pagingElement).children("li").each(function(){e(this).off()})}function c(){for(var t="",i=0;i<j.itemsPerPageOption.length;i++)t+="<option value='"+j.itemsPerPageOption[i]+"'>"+j.itemsPerPageOption[i]+"</option>";e(j.optionPagingElement).html(t),e(j.optionPagingElement).val(j.itemsPerPage),e(j.optionPagingElement).on("change",function(){j.itemsPerPage=e(j.optionPagingElement).children("option:selected").val(),l(1,j.itemsPerPage,v())})}function d(){var t=-1;return 1==j.rowNumber?t+=1:"",1==j.rowCheck?t+=1:"",e.isEmptyObject(j.rowDetail)?"":t+=1,t}function h(){e(E).find(".checkbox-column").each(function(){e(this).children().each(function(t,i){for(var a=0;a<j.rowChecked.length;a++)j.rowChecked[a]==e(this).attr("value")&&e(this).prop("checked",!0);e(this).on("click",function(){for(var e,t=!1,i=0;i<j.rowChecked.length;i++)j.rowChecked[i]==this.value&&(t=!0,e=i);t?j.rowChecked.splice(e,1):j.rowChecked[j.rowChecked.length]=parseInt(this.value),p()})})}),p()}function p(){for(var t=e(E).children("thead").find('input[type="checkbox"]'),i=f(),a=!0,r=0;r<i.length;r++)e(i[r]).prop("checked")||(a=!1);a?t.prop("checked",!0):t.prop("checked",!1)}function f(){var t=[];return e(E).find(".checkbox-column").each(function(){e(this).children().each(function(i,a){t[t.length]=e(this)})}),t}function u(){var t=e(E).children("thead").find('input[type="checkbox"]');e(t).on("click",function(){var t=f();if(e(this).prop("checked"))for(var i=0;i<t.length;i++){e(t[i]).prop("checked",!0);for(var a,r=!1,n=0;n<j.rowChecked.length;n++)j.rowChecked[n]==e(t[i]).attr("value")&&(r=!0,a=n);r||(j.rowChecked[j.rowChecked.length]=parseInt(e(t[i]).attr("value")))}else for(var i=0;i<t.length;i++){e(t[i]).prop("checked",!1);for(var a,r=!1,n=0;n<j.rowChecked.length;n++)j.rowChecked[n]==e(t[i]).attr("value")&&(r=!0,a=n);r&&j.rowChecked.splice(a,1)}})}function m(){I={selector:j.searchInputElement,element:e(j.searchInputElement).clone()},j.columns.forEach(function(t,i){t.search=void 0==t.search?!0:t.search,t.search&&(void 0==t.custom_search?e(j.searchFieldElement).append('<option value="'+t.field+'">'+t.title+"</option>"):e(j.searchFieldElement).append('<option data-option="'+i+'" value="'+t.field+'">'+t.title+"</option>"))}),g(j.searchFieldElement),e(j.searchFieldElement).on("change",function(){g(e(this))})}function g(t){var i=e(t).find("option:selected").attr("data-option");if(void 0==i)e(j.searchInputElement).replaceWith(I.element),e(j.searchInputElement).on("keyup",function(){N(function(){l(1,j.itemsPerPage,v())},j.delayTime)});else{var a=e("<select></select>"),r=e(t).find("option:selected").attr("value");j.columns.forEach(function(t,i){if(t.field==r){if(-1==I.selector.indexOf(".")){var n=I.selector.replace("#","");e(a).attr("id",n),e(a).attr("class",t.custom_search.appendClass)}else{var n=I.selector.replace(".","");e(a).attr("class",t.custom_search.appendClass+" "+n)}t.custom_search.option.forEach(function(t,i){e(a).append('<option value="'+t.value+'">'+t.text+"</option>")})}}),e(a).on("change",function(){l(1,j.itemsPerPage,v())}),e(j.searchInputElement).replaceWith(a)}l(1,j.itemsPerPage,v())}function v(){var t=e(j.searchFieldElement).val(),i=e(j.searchInputElement).val(),a={field:t,value:i};return void 0==t||void 0==i?"":a}function w(t,i){if(C.total>=1){var a,r;a=t*i-i+1,r=t==Math.ceil(C.total/i)?t*i-(t*i-C.total):t*i,e(j.pageInfoElement).html("Showing "+a+" - "+r+" of "+C.total+" entries")}else e(j.pageInfoElement).html("Showing 0 - 0 of 0 entries")}function x(){e(E).children("thead").children().children().each(function(t,i){if("false"!=e(i).attr("sortable")){var a=e("<span></span>");e(a).css({width:"0px",height:"0px",border:"4px solid transparent","border-bottom":"5px solid #ccc",position:"absolute","margin-left":"5px","margin-top":"0px"}),e(this).append(a);var r=e("<span></span>");e(r).css({width:"0px",height:"0px",border:"4px solid transparent","border-top":"5px solid #ccc",position:"absolute","margin-left":"5px","margin-top":"11px"}),e(this).append(r)}})}function b(){j.sortBy=j.primaryField,x(),e(E).children("thead").children().children().each(function(t,i){"false"!=e(i).attr("sortable")&&(e(this).css("cursor","pointer"),e(this).on("click",function(){e(E).children("thead").children().children().each(function(t,i){e(this).children("span").remove()}),x();var t=e("<span></span>");e(this).append(t),null==e(this).attr("data-sortby")||"DESC"==e(this).attr("data-sortby")?(e(this).attr("data-sortby","ASC"),e(this).children("span").css({width:"0px",height:"0px",border:"4px solid transparent","border-bottom":"5px solid #333",position:"absolute","margin-left":"5px","margin-top":"3px"})):(e(this).attr("data-sortby","DESC"),e(this).children("span").css({width:"0px",height:"0px",border:"4px solid transparent","border-top":"5px solid #333",position:"absolute","margin-left":"5px","margin-top":"7px"})),j.sortBy=this.title,j.orderBy=e(this).attr("data-sortby"),l(j.activePageNumber,j.itemsPerPage,v())}))})}function y(){e(E).find(".detail-link").each(function(){e(this).off(),e(this).on("click",function(){var t=e(this).attr("data-id");if("false"==e(this).attr("data-expand")){var i="<tr id='detail-row-"+t+"' style='display: none;'><td colspan='"+(d()+1)+"'></td><td colspan='"+j.columns.length+"' class='detail-content'>"+j.rowDetail.formatter(C.rows[t],t);e(i).insertAfter(e(this).closest("tr")).fadeIn(),j.rowDetail.onExpandRow(C.rows[t],t);var a="<div class='detail-link' data-id='"+t+"' data-expand='true' style='width: 10px; height: 4px; margin-left: auto; margin-right: auto; cursor: pointer; margin-top: 8px; background-color: #595959; border: 1px solid #595959; -border-radius: 0.1em; -moz-border-radius: 0.1em; -webkit-border-radius: 0.1em;'></div>";e(this).closest("td").html(a)}else{e(this).closest("tr").next().fadeOut(function(){e(this).remove()});var a="<div class='detail-link' data-id='"+t+"' data-expand='false' style='width: 10px; height: 4px; margin-left: auto; margin-right: auto; cursor: pointer; margin-top: 8px; background-color: #595959; border: 1px solid #595959; -border-radius: 0.1em; -moz-border-radius: 0.1em; -webkit-border-radius: 0.1em;'><div style='width: 4px; height: 10px; cursor: pointer; margin-top: -4px; margin-left: 2px; background-color: #595959; border: 1px solid #595959; -border-radius: 0.1em; -moz-border-radius: 0.1em; -webkit-border-radius: 0.1em;'></div></div>";e(this).closest("td").html(a)}y()})})}function k(t,i,a,r,n,o){if(i>d()){var l,s;if(j.columns.forEach(function(e,t){t+d()+1==i&&(l=e.editable,s=e.field)}),l){var c,l=e(t).html(),h=r(s,l);if(j.columns.forEach(function(e,t){e.editable&&(c=t)}),"active"!=e(t).attr("inline-edit"))e(t).attr("inline-edit","active"),e(t).html("<form>"+h+"</form>"),c+d()+1==i&&n();else{e(t).attr("inline-edit","not-active");var p=e(t).children("form").serializeArray();e(t).html(p[0].value),C.rows[a][s]=p[0].value,c+d()+1==i&&o()}}}}function P(t,i,a,r,n,o){e(t).children().each(function(t,l){"all"==i?k(e(this),t,a,r,n,o):t==i+d()+1&&k(e(this),t,a,r,n,o)})}var E=e(this),C=[],I={},N=function(){var e=0;return function(t,i){clearTimeout(e),e=setTimeout(t,i)}}(),j=e.extend({url:"",primaryField:"",sortBy:"",orderBy:"DESC",pagingElement:"",optionPagingElement:"",searchFieldElement:"",searchInputElement:"",pageInfoElement:"",delayTime:800,rowNumber:!1,rowCheck:!1,columns:[],mergeCells:[],activePageNumber:1,itemsPerPage:5,itemsPerPageOption:[5,10,15,20],rowChecked:[],queryParams:{},rowDetail:{}},t);return this.reload=function(){l(j.activePageNumber,j.itemsPerPage,v())},this.getChecked=function(){return j.rowChecked},this.setChecked=function(e){for(var t=0;t<e.length;t++){for(var i=!1,a=0;a<j.rowChecked.length;a++)j.rowChecked[a]==e[t]&&(i=!0);i||(j.rowChecked[j.rowChecked.length]=e[t])}l(j.activePageNumber,j.itemsPerPage,v())},this.setUnchecked=function(e){for(var t=0;t<e.length;t++){for(var i,a=!1,r=0;r<j.rowChecked.length;r++)j.rowChecked[r]==e[t]&&(a=!0,i=r);a&&j.rowChecked.splice(i,1)}l(j.activePageNumber,j.itemsPerPage,v())},this.getRowData=function(e){return"all"==e?C.rows:C.rows[e]},this.editable=function(t){var i=e.extend({rowIndex:"all",columnIndex:"all",styler:function(e,t){return t},onEdit:function(){console.log("Edited")},onSave:function(){console.log("Saved")}},t);e(E).children("tbody").children(".main-row").each(function(t,a){"all"==i.rowIndex?P(e(this),i.columnIndex,t,i.styler,i.onEdit,i.onSave):t==i.rowIndex&&P(e(this),i.columnIndex,t,i.styler,i.onEdit,i.onSave)})},this.queryParams=function(t){j.queryParams=e.extend(j.queryParams,t)},this.formLoad=function(t,i){e(t).find("input[type=text]").each(function(){for(var t in C.rows[i])this.name==t&&e(this).val(C.rows[i][t])}),e(t).find("input[type=password]").each(function(){for(var t in C.rows[i])this.name==t&&e(this).val(C.rows[i][t])}),e(t).find("textarea").each(function(){for(var t in C.rows[i])this.name==t&&e(this).val(C.rows[i][t])}),e(t).find("select").each(function(){for(var t in C.rows[i])if(this.multiple){if(this.name==t+"[]"){var a=this;e.each(C.rows[i][t].split(","),function(t,i){e(a).children("option").each(function(){this.value==i&&e(this).prop("selected","true")})})}}else this.name==t&&e(this).val(C.rows[i][t])}),e(t).find("input[type=checkbox]").each(function(){for(var t in C.rows[i])this.name==t&&this.value==C.rows[i][t]&&e(this).prop("checked",!0)}),e(t).find("input[type=radio]").each(function(){for(var t in C.rows[i])this.name==t&&this.value==C.rows[i][t]&&e(this).prop("checked",!0)})},this.run=function(){i(),j.mergeCells.length>0&&a(),r(),b(),l(j.activePageNumber,j.itemsPerPage,v()),c(),m()},this}}(jQuery);